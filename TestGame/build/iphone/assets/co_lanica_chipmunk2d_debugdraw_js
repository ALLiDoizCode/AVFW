var ChipmunkDebugDraw=function(e,t,r,o,s){function n(e){return r.screen.height-e}function a(e){return 180*-e/Math.PI}function i(e){return null===e||void 0===e}var c={},d={},h={},u={},l=new t.cpBodyCallbackContainer,p=new t.cpBodyCallbackContainer;(null===s||void 0===s)&&(s={}),void 0===s.BB&&(s.BB=!0),void 0===s.Circle&&(s.Circle=!0),void 0===s.Poly&&(s.Poly=!1),void 0===s.Vertex&&(s.Vertex=!1),void 0===s.z&&(s.z=9999),void 0===s.stroke&&(s.stroke=2),void 0===s.red&&(s.red=0),void 0===s.green&&(s.green=1),void 0===s.blue&&(s.blue=0),void 0===s.dotsize&&(s.dotsize=2),void 0===s.Constraint&&(s.Constraint=!1),void 0===s.ConstraintConnection&&(s.ConstraintConnection=!1),s.strokex2=2*s.stroke,s.dotsizex2=2*s.dotsize,s.dotsizex4=4*s.dotsize;var m=!1,g=function(e){if(s.BB){e.setStrokeWidth(s.stroke);var t=e._start_x,r=e._start_y,o=e._width,n=e._height;e.drawRect(t,r,o,n)}},v=function(e){return{width:Math.abs(e.bb.r-e.bb.l)+s.strokex2,height:Math.abs(e.bb.t-e.bb.b)+s.strokex2}},f=function(e){e.setStrokeWidth(s.stroke),e.drawCircle(e._local_center_x,e._local_center_y,e._width/2)},y=function(e,t,r){var o=4*s.dotsize,n=o/2;e.fillRect(e._local_center_x+t-n,e._local_center_y+r-n,o,o)},_=function(e,r){var o=c[e.getCPtr()];if(!i(o)){var n=t.cpShapeGetShapeType(r);if(s.Circle&&n==t.CP_CIRCLE_SHAPE)f(o);else if((s.Poly||s.Vertex)&&n==t.CP_POLY_SHAPE)for(var a,d,h=t.cpPolyShapeGetNumVerts(r),u=0;h>u;u++){var l=t.cpPolyShapeGetVert(r,u),p={x:l.x+o._local_center_x,y:o.height-(l.y+o._local_center_y)};s.Vertex&&y(o,l.x,-l.y),s.Poly&&(u>0&&o.drawLine(a.x,a.y,p.x,p.y),u===h-1&&o.drawLine(p.x,p.y,d.x,d.y)),0===u&&(d={x:p.x,y:p.y}),a={x:p.x,y:p.y}}}},P=function(e){var r={anchr1:null,anchr2:null};return t.cpConstraintIsPinJoint(e)?r=t.cpConstraintGetPinJoint(e):t.cpConstraintIsSlideJoint(e)?r=t.cpConstraintGetSlideJoint(e):t.cpConstraintIsPivotJoint(e)?r=t.cpConstraintGetPivotJoint(e):t.cpConstraintIsGrooveJoint(e)?r=t.cpConstraintGetGrooveJoint(e):t.cpConstraintIsDampedSpring(e)?r=t.cpConstraintGetDampedSpring(e):t.cpConstraintIsDampedRotarySpring(e)?r=t.cpConstraintGetDampedRotarySpring(e):t.cpConstraintIsRotaryLimitJoint(e)?r=t.cpConstraintGetRotaryLimitJoint(e):t.cpConstraintIsRatchetJoint(e)?r=t.cpConstraintGetRatchetJoint(e):t.cpConstraintIsGearJoint(e)?r=t.cpConstraintGetGearJoint(e):t.cpConstraintIsSimpleMotor(e)&&(r=t.cpConstraintGetSimpleMotor(e)),r},T=function(e,r){var o=e.getCPtr(),s=d[o],u=r.getCPtr(),l=h[u],p=t.cpBodyGetPos(e);p.y=n(p.y);var m=P(r),g=m.anchr1,v=m.anchr2,f=!1;if(!i(s)){var _=c[o];i(_)||(s.x=_.x,s.y=_.y,s.anchorPoint={x:.5,y:.5},s.angle=_.angle),!i(g)&&r.a.equals(e)&&(y(s,g.x,-g.y),f=!0),!i(v)&&r.b.equals(e)&&(y(s,v.x,-v.y),f=!0),f&&s.reload()}if(!i(l)&&r.b.equals(e)&&!i(g)&&!i(v)){var T,S,k,b=t.cpBodyGetPos(r.a),E=t.cpBodyGetPos(r.b);k=t.cpBodyGetAngle(r.a),T=Math.cos(k),S=Math.sin(k),b.x=b.x+(g.x*T-g.y*S),b.y=b.y+(g.x*S+g.y*T),k=t.cpBodyGetAngle(r.b),T=Math.cos(k),S=Math.sin(k),E.x=E.x+(v.x*T-v.y*S),E.y=E.y+(v.x*S+v.y*T),b.y=n(b.y),E.y=n(E.y);var x=E.x-b.x,C=E.y-b.y,w=Math.sqrt(x*x+C*C),M=a(Math.atan2(C,x));M-=2*M,l.width=w,l.x=b.x,l.y=b.y,l.angle=M}},S=function(e,r){var o=c[e.getCPtr()];if(!i(o)){var d=t.cpBodyIsSleeping(e);if(m)r=!0;else{if(d&&o.sleeping)return;d!==o.sleeping&&(r=!0)}var h=t.cpBodyGetPos(e);h.y=n(h.y);var u=a(t.cpBodyGetAngle(e));d?o.color(1,1,1):(o.color(s.red,s.green,s.blue),o.anchorPoint={x:.5,y:.5},o.center={x:h.x,y:h.y},o.angle=u),r&&(g(o),(s.Circle||s.Poly||s.Vertex)&&t.cpBodyEachShape(e,_,l),o.reload()),s.Constraint&&t.cpBodyEachConstraint(e,T,p),o.sleeping=d}},k=function(e,r){r==t.CP_POLY_SHAPE&&(e.width=Math.abs(e.v_xmax-e.v_xmin)+s.strokex2,e.height=Math.abs(e.v_ymax-e.v_ymin)+s.strokex2),e._start_x=s.stroke,e._start_y=s.stroke,e._width=e.width-s.strokex2,e._height=e.height-s.strokex2,e._local_center_x=e.width/2,e._local_center_y=e.height/2,e._halfw=e._width/2,e._halfh=e._height/2},b=function(e,t){t.width=e.width,t.height=e.height,t._start_x=e._start_x,t._start_y=e._start_y,t._width=e._width,t._height=e._height,t._local_center_x=e._local_center_x,t._local_center_y=e._local_center_y,t._halfw=e._halfw,t._halfh=e._halfh},E=function(r,n){var a=r.getCPtr(),d=c[a];i(d)&&(d=e.createCanvasSprite(v(n)),d.z=s.z,c[a]=d,d.v_xmin=1/0,d.v_xmax=-1/0,d.v_ymin=1/0,d.v_ymax=-1/0,o.add(d));var h=t.cpShapeGetShapeType(n);if(h==t.CP_POLY_SHAPE)for(var u=t.cpPolyShapeGetNumVerts(n),l=0;u>l;l++){var p=t.cpPolyShapeGetVert(n,l);d.v_xmin=Math.min(d.v_xmin,p.x),d.v_xmax=Math.max(d.v_xmax,p.x),d.v_ymin=Math.min(d.v_ymin,p.y),d.v_ymax=Math.max(d.v_ymax,p.y)}k(d,h)},x=function(r,a){var u=r.getCPtr(),l=d[u],p=a.getCPtr(),m=h[p],g=t.cpBodyGetPos(r);if(g.y=n(g.y),i(l)){l=e.createCanvasSprite({width:s.dotsize,height:s.dotsize}),l.color(s.red,s.green,s.blue),l.z=s.z,d[u]=l;var v=c[u];i(v)||b(v,l),o.add(l)}i(m)&&s.ConstraintConnection&&(m=e.createSprite({width:s.dotsize,height:s.dotsize}),l.anchorPoint={x:.5,y:.5},l.center={x:g.x,y:g.y},l.color(s.red,s.green,s.blue),l.z=s.z,h[p]=m,o.add(m))},C=function(e){t.cpBodyEachShape(e,E,l),s.Constraint&&t.cpBodyEachConstraint(e,x,p)};this.addBody=function(e){i(e)||(u[e.getCPtr()]=e,C(e))},this.addBodies=function(e){for(var t=0;t<e.length;t++)this.addBody(e[t])},this.showBody=function(e){if(!i(e)){var r=e.getCPtr();i(c[r])||c[r].show(),t.cpBodyEachConstraint(e,function(e,t){i(d[r])||d[r].show();var o=t.getCPtr();i(h[o])||h[o].show()},p)}},this.hideBody=function(e){if(!i(e)){var r=e.getCPtr();i(c[r])||c[r].hide(),t.cpBodyEachConstraint(e,function(e,t){i(d[r])||d[r].hide();var o=t.getCPtr();i(h[o])||h[o].hide()},p)}},this.removeBody=function(e){if(!i(e)){var r=e.getCPtr();delete u[r],i(c[r])||(o.remove(c[r]),c[r].dispose(),delete c[r]),t.cpBodyEachConstraint(e,function(e,t){i(d[r])||(o.remove(d[r]),d[r].dispose(),delete d[r]);var s=t.getCPtr();i(h[s])||(o.remove(h[s]),h[s].dispose(),delete h[s])},p)}},this.showAll=function(){for(var e in u)this.showBody(u[e]);m=!0},this.hideAll=function(){for(var e in u)this.hideBody(u[e])},this.removeBodies=function(e){for(var t=0;t<e.length;t++)this.removeBody(e[t])},this.update=function(e){for(var t in u)S(u[t],e);m&&(m=!1)}};module.exports=ChipmunkDebugDraw;
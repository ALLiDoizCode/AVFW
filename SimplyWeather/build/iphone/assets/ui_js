function _getTargetFile(e,t,a){var o=Ti.Utils.sha1(e+"_"+t)+e.substr(e.lastIndexOf(".")),i=Ti.Filesystem.getFile(a||Ti.Filesystem.applicationCacheDirectory,o);return i}function _setBackgroundImage(e,t,a){var o,i=e._backgroundImage,r=e._backgroundTarget||t+"_"+a,n=_getTargetFile(i,r);if(n.exists())e.backgroundImage=n.nativePath;else{if(-1!==i.indexOf("://")){o=_getTargetFile(i,"tmp",Ti.Filesystem.tempDirectory);var d=Ti.Network.createHTTPClient({onload:function(){return o.write(this.responseData)?void _resizeBackgroundImage(e,t,a,o,n):void console.error("[UI] Could not write downloaded file to: "+o.nativePath)},onerror:function(e){console.error("[UI] Could not downloaded image: "+e.error)}});return d.open("GET",i),void d.send()}o=Ti.Filesystem.getFile(i),_resizeBackgroundImage(e,t,a,o,n)}}function _resizeBackgroundImage(e,t,a,o,i){if(!o.exists())return void console.error("[UI] backgroundImage not found: "+o.nativePath);var r=o.read(),n=r.width,d=r.height,c=n/d;t=Ti.UI.convertUnits(""+t,Ti.UI.UNIT_PX),a=Ti.UI.convertUnits(""+a,Ti.UI.UNIT_PX);var l,s,u=t/a;u>c?(l=t,s=Math.ceil(l/c)):(s=a,l=Math.ceil(s*c)),(n!==l||d!==s)&&(r=r.imageAsResized(l,s)),(l!==t||s!==a)&&(r=r.imageAsCropped({width:t,height:a})),i.write(r),e.backgroundImage=i.nativePath}function _onPostLayout(e){var t=e.source,a=t.size;t.removeEventListener("postlayout",_onPostLayout),_setBackgroundImage(t,a.width,a.height)}function _isAbsolute(e){return e&&e.toString().match(/^[1-9]+[0-9]*[a-z]*$/)}exports.createView=function(e){if(e.backgroundSize&&"cover"===e.backgroundSize&&e.backgroundImage&&"string"==typeof e.backgroundImage){if(e._backgroundImage=e.backgroundImage,delete e.backgroundImage,e.backgroundTarget){e._backgroundTarget=e.backgroundTarget,delete e.backgroundTarget;var t=_getTargetFile(e._backgroundImage,e._backgroundTarget);if(t.exists())return e.backgroundImage=t.nativePath,Ti.UI.createView(e)}var a=Ti.UI.createView(e);return _isAbsolute(e.width)&&_isAbsolute(e.height)?_setBackgroundImage(a,e.width,e.height):a.addEventListener("postlayout",_onPostLayout),a}return Ti.UI.createView(e)};